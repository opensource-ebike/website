<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tsdz2/flashing/Flash-the-firmware-on-TSDZ2">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="OpenSource-EBike" href="/opensearch.xml">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9270569596814796" crossorigin="anonymous"></script><title data-rh="true">Flash-the-firmware-on-TSDZ2 | OpenSource-EBike</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://opensource-ebike.org/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Flash-the-firmware-on-TSDZ2 | OpenSource-EBike"><meta data-rh="true" name="description" content="\\TOC\\"><meta data-rh="true" property="og:description" content="\\TOC\\"><link data-rh="true" rel="icon" href="/img/hotlink-ok/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://opensource-ebike.org/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2"><link data-rh="true" rel="alternate" href="https://opensource-ebike.org/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://opensource-ebike.org/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WZ05W1IA1Q-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.73f5193e.css">
<link rel="preload" href="/assets/js/runtime~main.8fb61e70.js" as="script">
<link rel="preload" href="/assets/js/main.8c04ad0f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/hotlink-ok/logo/logo.svg" alt="OpenSource-Ebike logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/hotlink-ok/logo/logo.svg" alt="OpenSource-Ebike logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OpenSource-Ebike</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/tsdz2/intro">TSDZ2</a><a class="navbar__item navbar__link" href="/docs/bafang/intro">Bafang</a><a class="navbar__item navbar__link" href="/docs/display/intro">Display</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div><a href="https://github.com/OpenSourceEBike/OpenSourceEBike.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/intro">TSDZ2 OpenSource firmware</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/archive/">Archive</a><button aria-label="Toggle the collapsible sidebar category &#x27;Archive&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/Bluetooth-and-USB">Bluetooth-and-USB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/FAQ">FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/How-TSDZ2-torque-sensor-works">How-TSDZ2-torque-sensor-works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/How-to-install-TSDZ2-on-a-full-suspension-bicycle">How-to-install-TSDZ2-on-a-full-suspension-bicycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/How-to-install-TSDZ2-on-your-bicycle">How-to-install-TSDZ2-on-your-bicycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/Interesting-forks-and-projects">Interesting-forks-and-projects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/TSDZ2-Glossary">TSDZ2-Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/TSDZ2-and-KT-LCD3-advanced-features-with-Flexible-OpenSource-firmwares">TSDZ2-and-KT-LCD3-advanced-features-with-Flexible-OpenSource-firmwares</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/TSZD2-Hardware-Information">TSZD2-Hardware-Information</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/Tutorial-BETA">TSDZ2 Firmware Updating &amp; Open Source firmware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tsdz2/Why-should-you-use-the-Flexible-OpenSource-firmware-on-your-TSDZ2">Why-should-you-use-the-Flexible-OpenSource-firmware-on-your-TSDZ2</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/development/">Various</a><button aria-label="Toggle the collapsible sidebar category &#x27;Various&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/displays/">Displays</a><button aria-label="Toggle the collapsible sidebar category &#x27;Displays&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/examples/">Example Bikes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Example Bikes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/tsdz2/flashing/">Flashing Firmwares</a><button aria-label="Toggle the collapsible sidebar category &#x27;Flashing Firmwares&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/Flash-the-bootloader-and-firmware-on-SW102-using-SWD">Flash-the-bootloader-and-firmware-on-SW102-using-SWD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD">Flash-the-firmware-on-850C-using-SWD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/Flash-the-firmware-on-860C-850C-using-bootloader">Flash-the-firmware-on-860C-850C-using-bootloader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/Flash-the-firmware-on-Bafang-850C-LCD">Flash-the-firmware-on-Bafang-850C-LCD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/Flash-the-firmware-on-SW102">Flash-the-firmware-on-SW102</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2">Flash-the-firmware-on-TSDZ2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/How-to-flash-the-Flexible-OpenSource-firmware-on-KT-LCD3">How-to-flash-the-Flexible-OpenSource-firmware-on-KT-LCD3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tsdz2/flashing/How-to-install-the-Flexible-OpenSource-firmware">How-to-install-the-Flexible-OpenSource-firmware</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/improvements/">Improvements</a><button aria-label="Toggle the collapsible sidebar category &#x27;Improvements&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/issues/">Issues</a><button aria-label="Toggle the collapsible sidebar category &#x27;Issues&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/tsdz2/opensource firmware/">OpenSource Firmwares</a><button aria-label="Toggle the collapsible sidebar category &#x27;OpenSource Firmwares&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/tsdz2/flashing/"><span itemprop="name">Flashing Firmwares</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Flash-the-firmware-on-TSDZ2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Flash-the-firmware-on-TSDZ2</h1></header><p>_<!-- -->_<!-- -->TOC<!-- -->_<!-- -->_</p><h1>Wire the STLinkV2 to the TSDZ2 wheel speed sensor cable</h1><p>The microcontroller chip that need to be flashed with the firmware is
the STM8S105. The needed wires from the STLinkV2 are GND, 5V and SWIM,
which are to be connected to pins on the plug for the wheel speed sensor
cable.</p><p>You can either connect directly to those pins, or acquire and set up a
plug to connect to that cable.</p><p>NOTE: the wires from the STLink should be short, like 10 centimeters, or
you will probably get errors while trying to flash. If you need a long
cable, try to use an USB extension instead.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="to_connect_directly">To connect directly:<a class="hash-link" href="#to_connect_directly" title="Direct link to heading">​</a></h2><p>This is quite straightforward using female-ended jumper cables as are
typically supplied with the STMLink adapter. See <a href="https://youtu.be/S2SRKu6-Qyw" target="_blank" rel="noopener noreferrer">this Youtube
video</a>, but in summary</p><ol><li>Remove the black plastic ends from one end of the jumper leads by
lifting the small retaining tab and gently slipping them off to
leave the metal connector underneath</li><li>put heatshrink over the metal ends to prevent shorts (not essential,
but wise)</li><li>slightly enlarge the holes since the motor plug pins are a little
thicker than male jumper lead ends, e.g. by inserting a male jumper
rotated 45 degrees.</li><li><strong>Disconnect your battery before connecting</strong>. At least some ST Link
clones will be damaged otherwise and will then appear to work, but
will not connect.</li><li>Connect them in as follows with the flat of the cable plug at the
bottom:<ol><li>GND to the bottom left pin</li><li>SWIM to the bottom right pin</li><li>5V to the top pin (note some users have found connecting to 3.3V
output pin from ST Link to work if 5V does not)</li><li>SWIM_RST to bottom center pin (optional, can help in case
flashing does not succeed)</li></ol></li></ol><p><a href="https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/TSDZ2_speed_Sensor_Pinout.jpg" target="_blank" rel="noopener noreferrer">https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/TSDZ2_speed_Sensor_Pinout.jpg</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="to_acquire_and_make_a_plug_to_connect">To acquire and make a plug to connect:<a class="hash-link" href="#to_acquire_and_make_a_plug_to_connect" title="Direct link to heading">​</a></h2><p>You may wish to do this if you frequently flash your motor or dislike
the direct pin connection method above. Some options are:</p><ol><li>buy an extra speed sensor and cut the sensor from the cable and so
you will have a cable with a connector that you can use only for
programming - be careful, it appears some speed sensors (eg with Y
Splitter for light cables) do not have the wires connected required
for flashing</li><li>buy a speed sensor extension cable (have not confirmed myself if all
wires for flashing are present)</li><li>cut the cable to wire the needed wires for flashing and keep the
other wires intact - this will work perfectly and you can avoid to
buy the extra wheel speed sensor</li></ol><p>Here is the list of wires: The connections to STLinkV2 clone:</p><ul><li>purple wire connect to STLinkV2 RST pin (Potentially optional, did
not appear to be needed flashing from Windows)</li><li>orange wire connect to STLinkV2 GND pin</li><li>black wire connect to STLinkV2 SWIM pin</li><li>brown wire connect to STLinkV2 VCC/5V pin (Optional - For those who
want to flash without a battery attached)</li></ul><p>Example of my wiring:</p><p><a href="https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/STLinkV2_to_TSDZ2_motor_controller-01.png" target="_blank" rel="noopener noreferrer">https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/STLinkV2_to_TSDZ2_motor_controller-01.png</a></p><p><a href="https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/STLinkV2_to_TSDZ2_motor_controller-02.png" target="_blank" rel="noopener noreferrer">https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/STLinkV2_to_TSDZ2_motor_controller-02.png</a></p><h1>Download and flash the firmware</h1><ol><li><a href="https://www.st.com/en/development-tools/stvp-stm32.html" target="_blank" rel="noopener noreferrer">Download STVP for Windows
here</a>. This
software is from the STM8S105 manufacture for flashing the firmware.
NOTE: if you are on Linux or MAC, you can use other alternative
tool. For instance, <a href="https://opensourceebikefirmware.bitbucket.io/development_tsdz2/Various--2018.04.18_-_original_firmware_and_debug_session_using_OpenOCD.html" target="_blank" rel="noopener noreferrer">on Linux you can use
stm8flash</a>.</li><li><a href="https://github.com/OpenSource-EBike-firmware/Color_LCD/releases" target="_blank" rel="noopener noreferrer">Download the firmware hex file from
here</a>.
Pick the file with name TSDZ2_xxxxxxx.hex.</li><li>Flash the firmware (Program Memory tab) with the motor controller
powered on. Select the proper processor type, both the TSDZ2
controller and the LCD3 display use a stm8s105x6 processor.</li></ol><p>If flashing does not work, try turning on the display.</p><p>NOTE: sometimes the microcontroller on the TSDZ2 motor controllers stops
to working (this can happens when we disconnect the battery or something
like that), we can´t program it anymore. The way to recover is by
programming the option bytes to some default value.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="flash_firmware_on_linux">Flash firmware on Linux<a class="hash-link" href="#flash_firmware_on_linux" title="Direct link to heading">​</a></h2><p>Both the TSDZ2 and the LCD3 use a stm8s105x6 processor.\
NOTE: when running stm8flash and if you are using for instance Linux
Ubuntu, you may need to run it using \&#x27;sudo stm8flash xxx\&#x27; to get the
stm8flash working.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing_stm8flash_on_linux">Installing stm8flash on linux<a class="hash-link" href="#installing_stm8flash_on_linux" title="Direct link to heading">​</a></h3><p>I found that there was no package available to install stm8flash using
ubuntu. Instead I installed stm8flash from source. Do something like the
following:</p><p><code>% git clone </code><a href="https://github.com/vdudouyt/stm8flash.git" target="_blank" rel="noopener noreferrer"><code>https://github.com/vdudouyt/stm8flash.git</code></a>\
<code>% cd stm8flash</code>\
<code>% make</code>\
<code>% make install</code>\
You should then find that the smt8flash command is available:</p><p><code>% stm8flash</code>\
<code>Usage: stm8flash [-c programmer] [-S serialno] [-p partno] [-s memtype] [-b bytes] [-r|-w|-v] ``&lt;filename&gt;</code>{=html}<code>...</code>\</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backup_existing_firmware">Backup existing firmware<a class="hash-link" href="#backup_existing_firmware" title="Direct link to heading">​</a></h3><p>First backup everything (just to be sure):\
<code>stm8flash -c stlinkv2 -p stm8s105?6 -s opt -r TSDZ_orig_opt.bin</code>\
<code>stm8flash -c stlinkv2 -p stm8s105?6 -r TSDZ_orig.bin</code>\
<code>stm8flash -c stlinkv2 -p stm8s105?6 -s eeprom -r TSDZ_orig_eeprom.bin</code>\
Erase protection:\
<code>echo &quot;00 00 ff 20 df 00 ff 00 ff 00 ff 00 ff 00 ff&quot; | xxd -r -p &gt; option_bytes_pwm_n_channels_enabled.bin</code>\
<code>stm8flash -c stlinkv2 -p stm8s105?6 -s opt -w option_bytes_pwm_n_channels_enabled.bin</code>\</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flash_firmware">Flash firmware<a class="hash-link" href="#flash_firmware" title="Direct link to heading">​</a></h3><p><code>stm8flash -c stlinkv2 -p stm8s105?6 -w TSDZ2-vxxx.hex</code>\
NB: This did not work for me on linux ubuntu (buster/sid). I got the
following error:</p><p><code>% stm8flash -c stlinkv2 -p stm8s105?6 -w TSDZ2-v1.1.1.hex</code>\
<code>Determine FLASH area</code>\
<code>Due to its file extension (or lack thereof), &quot;TSDZ2-v1.1.1.hex&quot; is considered as INTEL HEX format!</code>\
<code>30555 bytes at 0x8000... Tries exceeded</code>\
<code>%</code>\
I needed to convert the hex formatted file above (<a href="https://en.wikipedia.org/wiki/Intel_HEX" target="_blank" rel="noopener noreferrer">intel hex
format</a>) to a binary file with
the following command:</p><p><code>objcopy -I ihex -O binary TSDZ2-vx.y.z.hex TSDZ2-vx.y.z.hex.bin</code>\
You can now take this newly created file (TSDZ2-vx.y.z.hex<strong>.bin</strong>) and
use that to flash the microcontroller instead:</p><p><code>stm8flash -c stlinkv2 -p stm8s105?6 -v TSDZ2-vx.y.z.hex.bin</code>\</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="restoring_a_backup">Restoring a backup<a class="hash-link" href="#restoring_a_backup" title="Direct link to heading">​</a></h3><p><code>   # Erasing protection</code>\
<code>   echo &quot;00 00 ff 20 df 00 ff 00 ff 00 ff 00 ff 00 ff&quot; | xxd -r -p &gt; option_bytes_$</code></p><p><code>   # programming option bytes</code>\
<code>   stm8flash -c stlinkv2 -p stm8s105?6 -s opt -w TSDZ_orig_opt.bin</code></p><p><code>   # programming eeprom</code>\
<code>   stm8flash -c stlinkv2 -p stm8s105?6 -s eeprom -w TSDZ_orig_eeprom.bin</code></p><p><code>   # Programming firmware</code>\
<code>   stm8flash -c stlinkv2 -p stm8s105?6 -w TSDZ_orig.bin</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="swim_error_0x05">SWIM error 0x05<a class="hash-link" href="#swim_error_0x05" title="Direct link to heading">​</a></h4><p>Make sure you have the SWIM_RST (reset) pin connected between controller
and STLINKv2.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="swim_error_0x04">SWIM error 0x04<a class="hash-link" href="#swim_error_0x04" title="Direct link to heading">​</a></h4><p>Check the connection between controller and STLINKv2. A cable might be
loose or have bad connection.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/OpenSourceEBike/OpenSourceEBike.github.io/tree/master/docs/tsdz2/flashing/Flash-the-firmware-on-TSDZ2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tsdz2/flashing/Flash-the-firmware-on-SW102"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Flash-the-firmware-on-SW102</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tsdz2/flashing/How-to-flash-the-Flexible-OpenSource-firmware-on-KT-LCD3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How-to-flash-the-Flexible-OpenSource-firmware-on-KT-LCD3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#to_connect_directly" class="table-of-contents__link toc-highlight">To connect directly:</a></li><li><a href="#to_acquire_and_make_a_plug_to_connect" class="table-of-contents__link toc-highlight">To acquire and make a plug to connect:</a></li><li><a href="#flash_firmware_on_linux" class="table-of-contents__link toc-highlight">Flash firmware on Linux</a><ul><li><a href="#installing_stm8flash_on_linux" class="table-of-contents__link toc-highlight">Installing stm8flash on linux</a></li><li><a href="#backup_existing_firmware" class="table-of-contents__link toc-highlight">Backup existing firmware</a></li><li><a href="#flash_firmware" class="table-of-contents__link toc-highlight">Flash firmware</a></li><li><a href="#restoring_a_backup" class="table-of-contents__link toc-highlight">Restoring a backup</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Other</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 OpenSource-EBike</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8fb61e70.js"></script>
<script src="/assets/js/main.8c04ad0f.js"></script>
</body>
</html>