"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6023],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),h=o,m=p["".concat(s,".").concat(h)]||p[h]||f[h]||a;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2718:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return f}});var r=n(3117),o=n(102),a=(n(7294),n(3905)),i=["components"],l={},s=void 0,u={unversionedId:"tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD",id:"tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD",title:"Flash-the-firmware-on-850C-using-SWD",description:"Please follow the next steps to be able to flash the firmware.",source:"@site/docs/tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD.md",sourceDirName:"tsdz2/flashing",slug:"/tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD",permalink:"/docs/tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD",draft:!1,editUrl:"https://github.com/OpenSourceEBike/OpenSourceEBike.github.io/tree/master/docs/tsdz2/flashing/Flash-the-firmware-on-850C-using-SWD.md",tags:[],version:"current",frontMatter:{},sidebar:"tsdz2Sidebar",previous:{title:"Flash-the-bootloader-and-firmware-on-SW102-using-SWD",permalink:"/docs/tsdz2/flashing/Flash-the-bootloader-and-firmware-on-SW102-using-SWD"},next:{title:"Flash-the-firmware-on-860C-850C-using-bootloader",permalink:"/docs/tsdz2/flashing/Flash-the-firmware-on-860C-850C-using-bootloader"}},c={},f=[{value:"Buy STLinkV2 clone",id:"buy_stlinkv2_clone",level:2},{value:"JTAG SWD connector",id:"jtag_swd_connector",level:2},{value:"Software to flash",id:"software_to_flash",level:2},{value:"Linux",id:"linux",level:3},{value:"Windows",id:"windows",level:3}],p={toc:f};function h(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Please follow the next steps to be able to flash the firmware."),(0,a.kt)("p",null,"_","_","TOC","_","_"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WARNING:")," There is no way to backup the original bootloader and\nfirmware. Once you erase, both original bootloader and firmware you will\nerased forever."),(0,a.kt)("p",null,"Download the firmware binary file\n(Bafang_LCD_850C_firmware-for_bootloader-vxxx) from here:\n",(0,a.kt)("a",{parentName:"p",href:"https://github.com/OpenSource-EBike-firmware/Color_LCD/releases"},"https://github.com/OpenSource-EBike-firmware/Color_LCD/releases")),(0,a.kt)("h1",{id:"how_to_open_the_lcd"},"How to open the LCD"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"use something thin to force open the front cover, by making force on\nthe sides of the case"),(0,a.kt)("li",{parentName:"ol"},"remove the hard plastic layer that is on top of the LCD"),(0,a.kt)("li",{parentName:"ol"},"remove the 2 little screws that fix the LCD and the board to the\ncase")),(0,a.kt)("h1",{id:"flash_the_firmware"},"Flash the firmware"),(0,a.kt)("h2",{id:"buy_stlinkv2_clone"},"Buy STLinkV2 clone"),(0,a.kt)("p",null,"To be able to flash the firmware (both for TSDZ2 motor controller and\ndisplay), you will need the cheap clone of STLinkV2, that you can buy on\nEBay as cheap as 2\u20ac."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WARNING:")," we found that some STLinkV2 clones can\\'t flash very well\nthe motor controller while other do it well. A good idea is to buy like\n3 different STLinkV2 clones, from different shops."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/STLinkV2_clone.png"},"https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/raw/master/STLinkV2_clone.png")),(0,a.kt)("h2",{id:"jtag_swd_connector"},"JTAG SWD connector"),(0,a.kt)("p",null,"The JTAG SWD pins are available on the board, on the pads as seen on\nnext picture, with the following JTAG pins that you should connect to\nthe STLinkV2:"),(0,a.kt)("p",null,"+----------------------+---------------------------------------------------+\n| ",(0,a.kt)("strong",{parentName:"p"},"Pad number"),"\\      | ",(0,a.kt)("strong",{parentName:"p"},"JTAG name"),"                                     |\n| (from left to right) |                                                   |\n+----------------------+---------------------------------------------------+\n| 1                    | GND                                               |\n+----------------------+---------------------------------------------------+\n| 2                    | NRST                                              |\n+----------------------+---------------------------------------------------+\n| 3                    | SWCLK                                             |\n+----------------------+---------------------------------------------------+\n| 4                    | SWDIO                                             |\n+----------------------+---------------------------------------------------+\n| 5                    | VCC 3.3V\\                                         |\n|                      | (no need to connect if LCD is already powered on) |\n+----------------------+---------------------------------------------------+"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/OpenSource-EBike-firmware/Color_LCD/raw/master/Bafang_color_LCD_850C/Bafang_850C_board-JTAG.jpg"},"https://github.com/OpenSource-EBike-firmware/Color_LCD/raw/master/Bafang_color_LCD_850C/Bafang_850C_board-JTAG.jpg")),(0,a.kt)("h2",{id:"software_to_flash"},"Software to flash"),(0,a.kt)("p",null,"To flash the firmware, use the software tool that works on your\noperation system to flash the STM32F103 microcontrollers."),(0,a.kt)("p",null,"On the very first time, you will need to first erase and/or unlock the\nmicrocontroller."),(0,a.kt)("h3",{id:"linux"},"Linux"),(0,a.kt)("p",null,"Use ",(0,a.kt)("em",{parentName:"p"},"OpenOCD"),".\\"),(0,a.kt)("h3",{id:"windows"},"Windows"),(0,a.kt)("p",null,"Use the ",(0,a.kt)("strong",{parentName:"p"},"STM32 ST-LINK Utility"),". Here the main steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Target Chip erase"),(0,a.kt)("li",{parentName:"ul"},"Load bin file (load the firmware bin file)"),(0,a.kt)("li",{parentName:"ul"},"Target program")))}h.isMDXComponent=!0}}]);